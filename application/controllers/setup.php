<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Setup extends CI_Controller {

	public function __construct() {
	    parent::__construct();
	    
	    /* Load the libraries and helpers */
	    $this->load->database();
	}

	private function doesConstraintExist($constraintName){
		if(!empty ($constraintName)){
			$sql = "SELECT 1 FROM information_schema.TABLE_CONSTRAINTS WHERE ".
                   "CONSTRAINT_SCHEMA = DATABASE() AND ".
                   "CONSTRAINT_NAME   = ?";
                   
            $query = $this->db->query($sql, array($constraintName));  
            return $query->num_rows()>0;
		}
		return false;
	}

	public function user($what=null){

		$createTable = function(){

$table = <<<'EOD'
CREATE TABLE IF NOT EXISTS `user` (
`id` int(11) NOT NULL AUTO_INCREMENT,
`firstName` varchar(255) NOT NULL,
`middleName` varchar(255) DEFAULT NULL,
`lastName` varchar(255) NOT NULL,
`email` varchar(255) NOT NULL,
`password` varchar(255) NOT NULL,
`salt` varchar(255) NOT NULL,
`createdOn` datetime NOT NULL,
`updatedOn` datetime NOT NULL,
UNIQUE KEY `UNQ1_USER` (`email`),
PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;
EOD;
			$query = $this->db->query($table);	
		};

		$insertData = function(){
			$salt = substr(str_shuffle(MD5(microtime())), 0, 10);
			$createdOn = date("Y-m-d H:i:s");
			$password = hash('sha512','Letmein5%'.$salt);

$record = <<<EOD
INSERT INTO `user` (`id`, `firstName`, `middleName`, `lastName`, `email`, `password`, `salt`, `createdOn`, `updatedOn`) VALUES
(1, 'Deewendra', 'Gopal', 'Shrestha', 'deewendra.shrestha@gmail.com', '{$password}', '{$salt}', '{$createdOn}', '{$createdOn}')
EOD;
			$query = $this->db->query($record);	
		};

		$clearData = function(){
$record = <<<'EOD'
TRUNCATE TABLE `user`
EOD;
			$query = $this->db->query($record);	
		};

		if(isset($what)){
			if($what==='table'){
				$createTable();
			} else if ($what==='data'){
				$insertData();
			} else if ($what==='clear'){
				$clearData();
			} 
		}
		else {
			$createTable();
			$clearData();
			$insertData();
		}
	}

	/**
	 * Sets up DB.
	 *
	 */
	public function index()	{
		$tables = array();
		$constraints = array();
		$records = array();

//TABLE SCRIPTS		

		array_push($tables, array('name'=>'user', 'script'=>$table));		

	
$table = <<<'EOD'
CREATE TABLE IF NOT EXISTS `album` (
`id` int(11) NOT NULL AUTO_INCREMENT,
`name` varchar(255) NOT NULL,
`description` text,
`uploadDate` date NOT NULL,
`coverPhoto` int(11) DEFAULT NULL,
UNIQUE KEY `UNQ1_ALBUM` (`name`),
PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1
EOD;
		array_push($tables, array('name'=>'album', 'script'=>$table));		

$table = <<<'EOD'
CREATE TABLE IF NOT EXISTS `photo` (
`id` int(11) NOT NULL AUTO_INCREMENT,
`album` int(11) NOT NULL,
`name` varchar(255) NOT NULL,
`description` int(11) NOT NULL,
`meta` text,
PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1
EOD;
		array_push($tables, array('name'=>'photo', 'script'=>$table));	

$table = <<<'EOD'
CREATE TABLE IF NOT EXISTS `blog_category` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UNQ1_BLOG_CATEGORY` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 
EOD;
		array_push($tables, array('name'=>'blog_category', 'script'=>$table));	

$table = <<<'EOD'
CREATE TABLE IF NOT EXISTS `blog` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `category_id` int(11) NOT NULL,
  `title` varchar(500) NOT NULL,
  `content` text,
  `post_dt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `attachment` longblob,
  `filename` varchar(200) DEFAULT NULL,
  `filetype` varchar(200) DEFAULT NULL,
  `filesize` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`,`category_id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 
EOD;
		array_push($tables, array('name'=>'blog', 'script'=>$table));

//CONSTRAINTS SCRIPTS
$constraint = <<<'EOD'
ALTER TABLE `photo` ADD CONSTRAINT `FK1_PHOTO` FOREIGN KEY (`album`) REFERENCES `album` (`id`) ON DELETE CASCADE
EOD;

		array_push($constraints, array('name'=>'FK1_PHOTO', 'script'=>$constraint));

//INSERT RECORDS SCRIPTS
$record = <<<'EOD'
TRUNCATE TABLE `blog_category`
EOD;
	array_push($records, $record);

$record = <<<'EOD'
INSERT INTO `blog_category` (`id`, `name`) VALUES
(2, 'MOBILE'),
(3, 'MYSQL'),
(1, 'PHP')
EOD;
	array_push($records, $record);

$record = <<<'EOD'
TRUNCATE TABLE `blog`
EOD;
	array_push($records, $record);	

$record = <<<'EOD'
INSERT INTO `blog` (`id`, `category_id`, `title`, `content`, `post_dt`, `attachment`, `filename`, `filetype`, `filesize`) VALUES
(1, 1, 'Creating a basic MVC based solution in PHP', '<p>What is this MVC people talk about these days? That was my initial thought when I started hearing about MVC in my work place back in around 2006. After looking it up in google, I first got that MVC is short hand for Model, View and Controller and then I lost interest. Few weeks passed by and then I was still hearing MVC from every angle possible - folks who spoke about MVC had kinda smug on their face. So I forced myself to look into it one more time - one of the best decision I made in my career. This is what I had engraved in my mind and still have : Model is where your business rule goes, View is associated with the visual aspect of your code so in web world that must mean HTML CSS stuff and then Controller is a mysterious beast that glues Model and View together. The rule is - user will interact with just controller and the controller will do the task of instantiating the right model and calling proper methods on it and supplying data to the correct view and rendering it. Simple right? Well not so fast, I knew how to put model in code but view and controller made no sense to me because I was so used to having these both mixed up together, I couldn&#39;t fathom how I will be able to separate them and then I had opportunity to work with smarty template engine and wolla I could piece together the puzzle. Smarty basically is a HTML file and has placeholders, and the value of the placeholder is provided by controller. Now smarty also supports plugins and control structure etc etc but lets not go there. The solution we will be building won&#39;t be using smarty but since PHP itself is pretty darn good templating tool, we will be using it. OK enough of history, now to the details.</p>\r\n\r\n<p>I am assuming that you have wamp or something equivalent running and we are able to run php scripts. Lets assume that our working folder/project name in &quot;simplemvc&quot;, the folder structure of simplemvc will look like this:<br />\r\nsimplemvc\\.htaccess<br />\r\nsimplemvc\\index.php /* mother controller */<br />\r\nsimplemvc\\model /* folder where all your models rest */<br />\r\nsimplemvc\\model\\userModel.php<br />\r\nsimplemvc\\view /* folder where all your views rest */<br />\r\nsimplemvc\\view\\listUser.php<br />\r\nsimplemvc\\controller /* folder where all your controllers rest */<br />\r\nsimplemvc\\controller\\user.php<br />\r\nsimplemvc\\lib /*some library functions*/<br />\r\nsimplemvc\\lib\\helper.php<br />\r\nsimplemvc\\lib\\model.php<br />\r\nsimplemvc\\lib\\view.php<br />\r\nsimplemvc\\lib\\controller.php</p>\r\n\r\n<p>Before proceeding I must say this is just one of the many ways that you can implement MVC in php. Most popular PHP frameworks already follow MVC paradigm, you can dissect the code and understand how they have implemented the MVC paradigm. This post is to give you idea on how you can implement your own &quot;basic&quot; MVC in php using OOP.</p>\r\n\r\n<p><br />\r\nFirst we will create .htaccess file under simplemvc folder with following content :</p>\r\n\r\n<div class="code">\r\n<p>RewriteEngine On<br />\r\nRewriteCond %{REQUEST_FILENAME} !(?=jpg|png|gif|js|css|pdf|docx|htm)<br />\r\nRewriteRule ^(.*)$ index.php</p>\r\n</div>\r\n\r\n<p>What this rewrite rule does is, for any page request like http://hostname/simeplmvc/* except for files with extension jpg or png or gif or js or css or pdf or docx or htm files, the request will get passed to index.php. Think of index.php as mother controller who creates other child controllers. Why we would want this?<br />\r\na) we can use very structured URL of format htttp://HOSTNAME/CONTROLLER_NAME/METHOD_OR_ACTION_TO_INVOKE_IN_CONTROLLER[/GET PARAMS]<br />\r\nb) most rest web services use this kind of URL pattern<br />\r\nc) we can take advantage of this to make URL more SEO friendly<br />\r\nNote : Generally adding .htaccess file works but if it doesn&#39;t then follow http://www.tildemark.com/enable-htaccess-on-apache/</p>\r\n\r\n<p><br />\r\nNext we will look into index.php. Since all the requests are forwarded to index.php, the task of this script would be to find the correct controller and method on the controller to invoke based on the url of the request. The code for index.php would look like :</p>\r\n\r\n<div class="code">\r\n<p>&lt;?php<br />\r\nrequire_once(&quot;lib/helper.php&quot;);<br />\r\nrequire_once(&quot;lib/controller.php&quot;);<br />\r\nrequire_once(&quot;lib/model.php&quot;);<br />\r\nrequire_once(&quot;lib/view.php&quot;);</p>\r\n\r\n<p>$urlParts = helper::parseURL();<br />\r\n$controllerName = $urlParts[&#39;CONTROLLER&#39;];<br />\r\n$actionName = $urlParts[&#39;ACTION&#39;];<br />\r\n$_GET = $urlParts[&#39;GET&#39;];</p>\r\n\r\n<p>//CHECKING IF THE REQUESTED CONTROLLER EXISTS OR NOT<br />\r\nif (file_exists(&#39;controller/&#39;.$controllerName . &quot;.php&quot;)) {<br />\r\n&nbsp;&nbsp;&nbsp; include(&#39;controller/&#39;.$controllerName. &quot;.php&quot;);<br />\r\n&nbsp;&nbsp;&nbsp; $obj = new $controllerName;</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; if (method_exists($obj, $actionName)) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call_user_func_array(array($obj, $actionName), array());<br />\r\n&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp;&nbsp; else<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &#39;Sorry the requested action doesn\\&#39;t exist!&#39;;<br />\r\n}<br />\r\nelse {<br />\r\n&nbsp;&nbsp;&nbsp; echo &#39;Sorry the requested page doesn\\&#39;t exist!&#39;;<br />\r\n}<br />\r\n?&gt;</p>\r\n</div>\r\n\r\n<p>Since we want OOP, it makes sense to represent model, view and cotroller each with their own class so that we can use template methods. I will write skeleton code for all these, you may add your own methods later to make it behave as you want.</p>\r\n\r\n<div class="code">\r\n<p>&lt;?php<br />\r\n//helper.php file<br />\r\ndefine(&quot;CONST_DEFAULT_CONTROLLER&quot;, &quot;user&quot;);<br />\r\ndefine(&quot;CONST_DEFAULT_ACTION&quot;, &quot;listUser&quot;);</p>\r\n\r\n<p>/* as the name suggests this is a helper class with some helper functions */<br />\r\nclass helper {<br />\r\n&nbsp;&nbsp; &nbsp;<br />\r\n&nbsp;&nbsp;&nbsp; /*<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * This function parses the URI and then returns an array with controller name,action name and get parameters<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; */<br />\r\n&nbsp;&nbsp;&nbsp; public static function parseURL($url = null) {<br />\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $url = is_null($url) ? $_SERVER[&#39;REQUEST_URI&#39;] : $url;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $urlParts = explode(&#39;/&#39;, $url);</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return array(&#39;CONTROLLER&#39; =&gt; (isset($urlParts[2]) &amp;&amp; trim($urlParts[2]) != &#39;&#39;) ? $urlParts[2] : CONST_DEFAULT_CONTROLLER,<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;ACTION&#39; =&gt; (isset($urlParts[3]) &amp;&amp; trim($urlParts[3]) != &#39;&#39;) ? self::getActionName($urlParts[3]) : CONST_DEFAULT_ACTION,<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;GET&#39; =&gt; self::returnGetParams($url));<br />\r\n&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp; &nbsp;<br />\r\n&nbsp;&nbsp;&nbsp; /*<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * This function returns the right action name<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * its handles the case where url is like hostname/simplemvc/user/listUser/id/1<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * or url is like hostname/simplemvc/user/listUser?id=1<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; */<br />\r\n&nbsp;&nbsp;&nbsp; public static function getActionName($url) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (strpos($url, &#39;?&#39;) === false) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $url;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return substr($url, 0, strpos($url, &#39;?&#39;));<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp;&nbsp; }</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; #This functions parses the URL and makes $_GET like array and returns it<br />\r\n&nbsp;&nbsp;&nbsp; #@param string $url<br />\r\n&nbsp;&nbsp;&nbsp; #$url is any valid URL</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; public static function returnGetParams($url = null) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $urlParts = explode(DIRECTORY_SEPARATOR, $url);</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (strpos($url, &#39;?&#39;) === false) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $gets = array();<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for ($i = 4; $i &lt;= count($urlParts); $i+=2) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (isset($urlParts[$i]) &amp;&amp; trim($urlParts[$i]) != &#39;&#39;) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $gets[$urlParts[$i]] = $urlParts[$i + 1];<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $gets;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //normal get params<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $_GET;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp;&nbsp; }</p>\r\n\r\n<p>}</p>\r\n\r\n<p>?&gt;</p>\r\n\r\n<p>&nbsp;</p>\r\n</div>\r\n\r\n<div class="code">&lt;?php<br />\r\n//controller.php file<br />\r\nclass controller {<br />\r\n&nbsp;&nbsp;&nbsp; public $view;/* will hold view object */<br />\r\n&nbsp;&nbsp; &nbsp;<br />\r\n&nbsp;&nbsp; &nbsp;//constructor<br />\r\n&nbsp;&nbsp;&nbsp; public function controller(){<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;view = new view();<br />\r\n&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp; &nbsp;<br />\r\n&nbsp;&nbsp; &nbsp;//returns view object<br />\r\n&nbsp;&nbsp;&nbsp; public function getView(){<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $this-&gt;view;<br />\r\n&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp; &nbsp;<br />\r\n&nbsp;&nbsp;&nbsp; //instantiates a model for you and returns the object<br />\r\n&nbsp;&nbsp;&nbsp; public function useModel($modelName) {\r\n<p>&nbsp;</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $filePathFull = &#39;model&#39;.DIRECTORY_SEPARATOR.$modelName.&quot;.php&quot;;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(!(file_exists($filePathFull))){<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo $filePathFull.&quot; model doesnot exist.&quot;;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include_once($filePathFull);<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $this-&gt;createObject($modelName);<br />\r\n&nbsp;&nbsp;&nbsp; }</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; //the idea was to create a factory but oh well<br />\r\n&nbsp;&nbsp;&nbsp; public function createObject($className) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new $className();<br />\r\n&nbsp;&nbsp;&nbsp; }</p>\r\n\r\n<p>}</p>\r\n\r\n<p>?&gt;</p>\r\n</div>\r\n\r\n<div class="code">&lt;?php<br />\r\n//model.php file<br />\r\nclass model {<br />\r\n&nbsp;&nbsp;&nbsp; //put your code here<br />\r\n&nbsp;&nbsp; &nbsp;//has nothing now but you may want to create db connection here<br />\r\n}\r\n<p>&nbsp;</p>\r\n\r\n<p>?&gt;</p>\r\n</div>\r\n\r\n<div class="code">\r\n<p>&lt;?php<br />\r\n//view.php file</p>\r\n\r\n<p>class templateAttributes {</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; protected $attributes;</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; public function templateAttributes() {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;setDefaultSettings();<br />\r\n&nbsp;&nbsp;&nbsp; }</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; private function setDefaultSettings() {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //load some default setting<br />\r\n&nbsp;&nbsp;&nbsp; }</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; public function getAttribute($key=null) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(is_null($key)){<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $this-&gt;attributes;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }else{<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $this-&gt;attributes[strtoupper($key)];<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />\r\n&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp; &nbsp;<br />\r\n&nbsp;&nbsp;&nbsp; /*<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * Function: reset<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * This function cleans the TemplateAttributes properties<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; */<br />\r\n&nbsp;&nbsp;&nbsp; public function reset(){<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;attributes = array();<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;setDefaultSettings();<br />\r\n&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp; &nbsp;<br />\r\n&nbsp;&nbsp;&nbsp; /*<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * Function: setAttribute<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * Parameters:<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $key - index by which to access the value, it could also be an array or string<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $val - value for the provided index($key)<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * This function assings a variable to a template<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; */</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; public function setAttribute($key=NULL, $val=NULL) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!is_null($key)) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (is_array($key)) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $key = array_change_key_case($key, CASE_UPPER);<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;attributes = array_merge($this-&gt;attributes, $key);<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;attributes[strtoupper($key)] = $val;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp;&nbsp; }</p>\r\n\r\n<p>}</p>\r\n\r\n<p>class view {</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; public function setTemplate($filePath) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $file = &#39;view&#39;. DIRECTORY_SEPARATOR . $filePath;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (file_exists($file))<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $file;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;Unable to include &quot; . $file . &#39;&lt;br&gt;&#39;;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp;&nbsp; }</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; /*<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * Function: fetch<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * Parameters:&nbsp;&nbsp; &nbsp;void<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * This function returns the HTML equivalent of the pasrsed template file<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; */</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; public function fetch($templatePath=false, $templateAttributeObj=null) {</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!($templatePath = $this-&gt;setTemplate($templatePath)) === false) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ob_start();<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $templateProperties = array();<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($templateAttributeObj instanceof templateAttributes) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $templateProperties = $templateAttributeObj-&gt;getAttribute();<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach ($templateProperties as $key =&gt; $val)<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $$key = $val;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include_once($templatePath);<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $content = ob_get_contents();<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ob_end_clean();<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $content;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return NULL;<br />\r\n&nbsp;&nbsp;&nbsp; }</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; /*<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * Function: display<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * Parameters:&nbsp;&nbsp; &nbsp;void<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; * This function prints the HTML equivalent of the pasrsed template file<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp; */</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; public function display($templatePath=false, $templateProperties=null) {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo $this-&gt;fetch($templatePath, $templateProperties);<br />\r\n&nbsp;&nbsp;&nbsp; }</p>\r\n\r\n<p>}<br />\r\n?&gt;</p>\r\n</div>\r\n\r\n<p>Now that we have necessary classes, let&#39;s use these to create working controller, model and view. We are going to create set of files to view list of users for this example. Lets start with model first.</p>\r\n\r\n<div class="code">\r\n<p>&lt;?php</p>\r\n\r\n<p>//model/userModel.php<br />\r\nclass userModel extends model {</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; //put your code here</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; function listValidUsers() {<br />\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//generally we would go to db and fetch the data<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return array(<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; array(&quot;ID&quot; =&gt; &quot;1&quot;, &quot;NAME&quot; =&gt; &quot;TEST USERS 1&quot;)<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; , array(&quot;ID&quot; =&gt; &quot;2&quot;, &quot;NAME&quot; =&gt; &quot;TEST USERS 2&quot;)<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );<br />\r\n&nbsp;&nbsp;&nbsp; }</p>\r\n\r\n<p>}</p>\r\n\r\n<p>?&gt;</p>\r\n</div>\r\n\r\n<p>Our template would be :</p>\r\n\r\n<div class="code">//file view/listUser.php<br />\r\n&lt;table border=&quot;1&quot;&gt;<br />\r\n&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;ID&lt;/td&gt;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;NAME&lt;/td&gt;<br />\r\n&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br />\r\n&nbsp;&nbsp;&nbsp; &lt;?php foreach($USERS as $row){?&gt;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;?php echo $row[&quot;ID&quot;];?&gt;&lt;/td&gt;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;?php echo $row[&quot;NAME&quot;];?&gt;&lt;/td&gt;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br />\r\n&nbsp;&nbsp;&nbsp; &lt;?php } ?&gt;<br />\r\n&lt;/table&gt;\r\n<p>&nbsp;</p>\r\n</div>\r\n\r\n<p>and finally the controller:</p>\r\n\r\n<div class="code">&lt;?php<br />\r\n//controller/user.php file<br />\r\nclass user extends controller {\r\n<p>&nbsp;</p>\r\n\r\n<p>&nbsp;&nbsp;&nbsp; function listUser() {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $model = $this-&gt;useModel(&#39;userModel&#39;);//get the model<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $view = $this-&gt;getView();<br />\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$objTAttrib = new TemplateAttributes();<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $objTAttrib-&gt;setAttribute(&#39;users&#39;, $model-&gt;listValidUsers());<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $view-&gt;display(&quot;listUser.php&quot;, $objTAttrib);<br />\r\n&nbsp;&nbsp;&nbsp; }</p>\r\n\r\n<p>}</p>\r\n\r\n<p>?&gt;</p>\r\n</div>\r\n\r\n<p>And there you have it, we have separated all three model, view and controller neatly.</p>\r\n\r\n<p>&nbsp;</p>\r\n\r\n<p>&nbsp;</p>', '2013-02-20 03:11:49', 0x504b0304140000000800555653426cef46ab6b000000740000001300000073696d706c656d76632f2e68746163636573730b4a2d2fca2c4975cd4bcfcc4b55f0cfe3e50a828838e7e7a528a85607b90686ba0687c4bb79fab8fa39fabad62a286ad8db6615a4d714e4a5d7a467a6d56415d7241717d714a4a4d5a4e42757d46494e46ac24d092acd495588d3d0d3d25451c8cc4b49add02bc8280000504b0304140000000000055853420000000000000000000000001500000073696d706c656d76632f636f6e74726f6c6c65722f504b03041400000008008b5d5342f70be47a18010000ff0100001d00000073696d706c656d76632f636f6e74726f6c6c65722f757365722e70687065914d6e83400c85f748dcc18a224122480ed096b452b7ddd1ec093861aac91861d3b46a7bf77af849a83a0b04cfdf7bb687fb5d5337611006db7518c01a7282b22edc09416ac320786e6c2198a84ac4a875b20cdf908f05ee5d85ab801a746ac2ab07ccf08d95116a371edc0e9d8656cfc8656b1a31e4808ed031b65eef6b8f452735b5cae005dd682d6dc1dc73801f82ae6228c9494bd6aaf4e5b341cfb173651f6a0dcbabd2f1ca17613ccb335568e101967ec334d3bc17afc4914fee5fa3d5dd8c7f3778b9e12794bd0ab14766101ddef22791d61c14756a982e68103bbda9f84feacd90668c72c58631384ac641d3ccafb12faca9fc2e9af26fb834ab0c6bb3cf7831adbcd1bfba48e65d26d78f1fbb7fecb230f805504b0304140000000800665e534230edc9085a010000e80200001300000073696d706c656d76632f696e6465782e7068707d525d4bc330147d2ff43f5cc7a01d8cf57d5387ccb81547ab6d07824ac9da3b5bc99a9ab4ea10ffbb69cb56dddcf29040cec73d27e47c9c27b9ae097c2b538121cf22343b2c5d5a09b21cc540a19ddee83f42c4b34270c64e92d63c4676027f4ff16307eb5ab714ec8e8a42c205340186c39c0a890b6f6e56946e3bd5a16b54b49de4d198b84ee0b9f339f18ce78a4ba322e5d921ef6a12d8aed370c22909fea2eaa28674cdb2263332b9b59d29d83710cc0878e47e41fc805c433b0bc883ed073eb81e386ea06be90acc55ca30c4cf5416d234dac89631d82f30804ed3bf075fba066aa559c4ca184feb76b25123eaf2e5abaa91e107ec31eb26b5afcab5c622e1f1365925eac3af676a43542ba28c85a54411aeca2c0aa910746336fba1b20f0dd2db26fa6e0e64125b4b8c120e86cf85d8409120541f026581313456107394d99351401df1cc5066caa832d9263b6e91d3173c6230befc01504b0304140000000000a15653420000000000000000000000000e00000073696d706c656d76632f6c69622f504b0304140000000800855d5342f656e5c1a2010000950300001c00000073696d706c656d76632f6c69622f636f6e74726f6c6c65722e7068707d525f4fdb30107fafd4ef70ab2a91a0917e00180c0d90f63040a59ab4a7ca752ec493eb8b629b8280efced9098d83d8fc6025bedf1fdfcf7772d6d4cd74329d2c0ea71338841581ac85b94770b5b2e070db68e1f02b9f1259e43a690b2fb0ea0b36b28429811a344cc23d0754f78fa572d41601b8e89c3aab0bb4b2558d5364802a90645c4b5a631baa11f15d785753cb48dca1e905a416d6266878e602afc66fb492307f50b83bee8e4685ca1b19bd066a96f7dcb0e6a1e1a3d340876f60780f9f59de6bbdfe4ff21eddef084ef45a74be35a9ec674a8b8532d609e3540813046ca9440d1577fd443e06db09d998256dfea2749f5fc25bfc15c8d93c6a5c8b2de6219ca4c54a69bc15aebef25a7393071178505cfc5c5efe58dd2cffacef2e6fcf97e7fc590c22c5ace019991d0f3aaacabe64416b8d8fca3a9b8d84f33c8d212ce4e1199b17b3bed192d01a7210858ad4e435f13352fb12d764247ef04a08e3c0658b9ce84dcc2b4d647884f70708b9aa1205ec0487ccf31f99fc1495903cb84fb0f10ea8861d6afd8f891a79c501dda7ffe17661ae064436ba4edcce4ea79337504b0304140000000800405d534248455e9dbc0200004a0700001800000073696d706c656d76632f6c69622f68656c7065722e7068709555514fdb30107eafd4ff70eb2a9240a50cd8132574150484545116d24913aa2ad3bac4c24d22db81a189ffbe739c94a44db7710f8973befbee7cf79d733a48a3b4dd6ab71674c9626a77cec73777e1ecc2bf1c4e46e10cbfc2603c1af941a7079d4c52d171fabb8c87e7e1f5f8461b7226d5a4346eb7e69c480911e52915f0bbdd0214f374f7cd1bf6218c98846516cf154b6248899054828a284c826b20f142af631054652296a8002204798517a6229827b11209e7081f9315ed1103a2d7b9eb23551a113f1515b20ce99a459a3d703607a988c2573d834930b2bb99e0e0419c71eee8ec0b77946287c999decc0d1d18407776e7073ffce0de0afcef131f2b8447b0a670923bf4ebfeb744288920f457ca9305b52dd7eae51ba674a5a939b739b36dbdb7c502ef0c6c262555f61aeefe68eac0de1e28c1561bda4f1e58569e64458d99ed6a7bef3d052d96e97173d4e3c6a8c7d5a892f2e5c909b6639817f9063bb261ba998a09b899c6951fe639183c539c2baa6e758fa569845314faedbff856f24a134eb0c7484195436b2786bd8a9051bce0e69c480a2f11151434171091b3270a5122957674255ba59cae9ee7ae9e1db79c0b972ddcc33568223ee43c600b6fedfc770e6f17da29e74f0b5b822d95481353b21e5803ec92e779b0245cd29aad9682841b2c7e038ac63b6c65f680110af82f3dd80ae75491d61d338bcfb51ec9faa530ca277b459e50d39d21214cf5ccada0b7ca963255a07dcbaf009d028b1ff353141bdda2fc247e8567c2d942c39749ec286d13e7aab74479a6a619bfb80efcf3701cfcc48be276180c71d934f31f6d4f17dbadc3984ba25a582d4ba499dd65b8ffb50ff83ef5f0dacce2ca003b5a7fe01d6d016bd1c96c0e7c97354e7cae2e46be01494b9eea7dcd658a995515700087d3feb6fb5b5db5f1595254e3ff93a3ae1b276245f8fbff4136a3697aede069fe189cb55b7f00504b03041400000008005d565342c79150d996000000df0000001700000073696d706c656d76632f6c69622f6d6f64656c2e7068703d8d410ac2301045f781dce1af8b980b8875e111bc40484713483321491151efeeb429ce6efefb8f7f1ab3cf5a696506ad30e0c670dea607a1f950d168ced1363a48ca5c4938c78a0f6e3ba89b65d304ce9444a2bf83d07f9a42e3725c8ba62ff5a92b5557426e8113f88e99278a2bd8e0c52ecd7391123d29edae8bb6d65ec45b323963f2d2f0e2a5c0490e4f85b4faae3be359ab1f504b0304140000000800355c5342e2ef1d65970300007f0b00001600000073696d706c656d76632f6c69622f766965772e706870ad565b4fdb30147e1e12ffe10c556a8a0abc032d42d06993ba51d1f2802614b9c929f516e2cc760ad5c67fdfb1734fcc65d2fcd0263ef7cb774e4ecf9275b2bbb3bb73b4bfbb03fbb01010ac597c8fa0d75c81c68724621a87742b8442a28b48c11f58e40465a5581c82483026212c658067ef18722de4a1613c32968288a94af3b9d6922f53d204bf0d15e82452680c3486d06325f9a4a4a6cb8807b04ae34073113b347903a30bf2d333911c8c15ea4b5cb134d273d49ac7f7c47692713d5786f9c6785eea7609d575b7e55baedda32ebdf27a3f713b8ad3286a68e02b8f2bdf5c5b86c1a0463347a24e655c04d14847c1f28c91c2778a7d575a6a912609caccde5d5d9123b0eac5768839fbf0290ff098ec508acafb85e99932fa2042162bdb038b6eb5a9c8e484e6b685acf8913b89d68437e856b48a0a46c0a464dbb2a235aed7eb5e85d736cbc2f04229af172855b76dedf849aad65e37b9fdc56ceacf17b7d3c9bc7f37b4a24d53ce1caa5a9794e41993ec01354a755c1837f582038255884fb0dcc2e39a076bd0025810a0ca12bd61514a68e51a02914621b0480958222134f31c84a4e72d844c33d0db044be52449caad3cac88cb68a31a6d784838b4365f2833a1d9641518094bce96115a9f4a5cd6caebceb4eaa0e4dbcd743ab42ed9c71660c0fbd8840cb49adfb01047d6126e16736c3ef3cef1b3a9e7d3951f3095f931848bf3f9c4bf99cd26d7f5ce2a15bcd487fe03ca7bec36c8d0da6cab7a6ebe1a34bfc35617c964dda4ac0b683b9f9eabd9bbe1f8589bb6dd721470f57a2b1ee18ce97573a29a5bb2d6378afa8770f9e57a72b1b8babef5e793d9f9f5393dc22194b235874c65ccb58f4f5c6995e91f0c9ae116b3cbd06ab2262fed3222ad25d8bb898baee37110a521c25e619ffefba74b39ee9f386dac081ff842c2cc8313af2bd4c1da05d40f1bc1c317509219cc40fa79f1750af82ba5651361ac41ac32b431251581ad5ca0268037d163bda156cb854cc247362c6ab6ce6abc5afea856500b534d1da699ca015af5439d8550351a8db21c76002696bed24c6aafdded958a720138c777e19733082a34698f0334a9ebec1637da9d769dda0fc68dc5fd065e695822a341ecb92c30958f99b1c5e6c0e1573e865ad03527ef665f50a0add4b7931a88589b561a99c493f77e7ea13ade131de3d0b7cbb9432ca0974bbbbf0d72263399abedf60a5e42aec8f1edbf22863ec6c8ffff0f98dc9d372053d5b0fbcd66a74e8e0e07fc9c5a1adf9af6e76cbcbbf317504b0304140000000000635853420000000000000000000000001000000073696d706c656d76632f6d6f64656c2f504b0304140000000800bc585342225fa9e8fb000000bc0100001d00000073696d706c656d76632f6d6f64656c2f757365724d6f64656c2e706870758f3f4fc33014c4f748f90e274f6d1511b52bd082d40c0c652029bb95bc124bae1df98fa002be3b761c2854e20d96efddfd7cf2cd66e8873ccbb372916758a0d1687bae5e08ae17168e8e83e48e8ab0d5da52f0b5b4f840331976a4b8eaa0075201a21f062269ea84d3e62a06cbd494aab6645b230627b4823ec05b323bdd918ce618b8e3def5da8420bd929af856726bcf61d09b23d5591c47f51e0b10a62c07ef70d2dea00d0e7a32f4ed1dbc6ac75629ac7be65274fbf09c9dcd238e690c396f14b831fc343bafe3a41d7bd832dcaec196ac007bbcdf55493655dd605f574f35966cfe972c2ed9d5bfecea373bbf4ef7cff885f1d8acf3ec0b504b0304140000000000515653420000000000000000000000001400000073696d706c656d76632f6e6270726f6a6563742f504b0304140000000000515653420000000000000000000000001c00000073696d706c656d76632f6e6270726f6a6563742f707269766174652f504b030414000000080051565342e569bfb835000000370000002e00000073696d706c656d76632f6e6270726f6a6563742f707269766174652f707269766174652e70726f70657274696573cbcc4b49add04bcbcc49b5cd04330b320a78b94a8b726c334a4a0aacf4f573f293137332f28b4bf48b33730b725273cb92f579b900504b0304140000000800515653420c7345eb730000008c0000002600000073696d706c656d76632f6e6270726f6a6563742f70726f6a6563742e70726f706572746965734d8abd0ac2301080f740dec2d55b4470b9551c3be82c69722681900b77890ed2776f0b0e8edf4faebe8c40d05c4f78f8b6d420169e5d81fc57166bf6f226d1cc15a7dbf43c9fac511ee209a87a0eb9467cdcafc7cba6c543c882604d7751c169c3972b4a3fd6c4d2b1cbd8c4876610e6becf2b504b030414000000080051565342102e820aae000000400100001f00000073696d706c656d76632f6e6270726f6a6563742f70726f6a6563742e786d6c8d8f410ec2201045f726de81b02f6377c6d0baf3047a006cc716530602b4d5db8b4dab4637b2829937f31f727f331d1bd0076da9e0b9d8708654d95a5353f0d3f1906df9be5cafa4f3f68a556409a750f03646b70318c75110c6332a0ac2fa0628c04c42ced31c4b47c6bbc33275dfa8b175df6110ae7562e6254cd83c5259bae8a6f72a26afb938356a15d53f12adcb7e445e4b48192c8336ae43335412a6f747083c531615f87691cb17d3fd01504b0304140000000000ce5b53420000000000000000000000000f00000073696d706c656d76632f766965772f504b03041400000008003c5c5342a293bb4280000000140100001b00000073696d706c656d76632f766965772f6c697374557365722e706870b329494cca495548ca2f4a492db2553254b2e3e55200029b9222280bc24bb1f374b1d10752a8827e8ebeae48c240264c9b8d7d414681425a7e516a627286864a68b06b50b04262b1824a517eb966b53d8a39c856c14c86e84f4dcec8076b8956f274518ab5b6b74373044ee5209761d380e1c45a05906380c2a08000b278b900504b01021400140000000800555653426cef46ab6b0000007400000013000000000000000100200000000000000073696d706c656d76632f2e6874616363657373504b010214001400000000000558534200000000000000000000000015000000000000000000100000009c00000073696d706c656d76632f636f6e74726f6c6c65722f504b010214001400000008008b5d5342f70be47a18010000ff0100001d00000000000000010020000000cf00000073696d706c656d76632f636f6e74726f6c6c65722f757365722e706870504b01021400140000000800665e534230edc9085a010000e802000013000000000000000100200000002202000073696d706c656d76632f696e6465782e706870504b01021400140000000000a15653420000000000000000000000000e00000000000000000010000000ad03000073696d706c656d76632f6c69622f504b01021400140000000800855d5342f656e5c1a2010000950300001c00000000000000010020000000d903000073696d706c656d76632f6c69622f636f6e74726f6c6c65722e706870504b01021400140000000800405d534248455e9dbc0200004a0700001800000000000000010020000000b505000073696d706c656d76632f6c69622f68656c7065722e706870504b010214001400000008005d565342c79150d996000000df0000001700000000000000010020000000a708000073696d706c656d76632f6c69622f6d6f64656c2e706870504b01021400140000000800355c5342e2ef1d65970300007f0b000016000000000000000100200000007209000073696d706c656d76632f6c69622f766965772e706870504b010214001400000000006358534200000000000000000000000010000000000000000000100000003d0d000073696d706c656d76632f6d6f64656c2f504b01021400140000000800bc585342225fa9e8fb000000bc0100001d000000000000000100200000006b0d000073696d706c656d76632f6d6f64656c2f757365724d6f64656c2e706870504b01021400140000000000515653420000000000000000000000001400000000000000000010000000a10e000073696d706c656d76632f6e6270726f6a6563742f504b01021400140000000000515653420000000000000000000000001c00000000000000000010000000d30e000073696d706c656d76632f6e6270726f6a6563742f707269766174652f504b0102140014000000080051565342e569bfb835000000370000002e000000000000000100200000000d0f000073696d706c656d76632f6e6270726f6a6563742f707269766174652f707269766174652e70726f70657274696573504b01021400140000000800515653420c7345eb730000008c00000026000000000000000100200000008e0f000073696d706c656d76632f6e6270726f6a6563742f70726f6a6563742e70726f70657274696573504b0102140014000000080051565342102e820aae000000400100001f000000000000000100200000004510000073696d706c656d76632f6e6270726f6a6563742f70726f6a6563742e786d6c504b01021400140000000000ce5b53420000000000000000000000000f000000000000000000100000003011000073696d706c656d76632f766965772f504b010214001400000008003c5c5342a293bb4280000000140100001b000000000000000100200000005d11000073696d706c656d76632f766965772f6c697374557365722e706870504b05060000000012001200fd040000161200000000, 'simplemvc.zip', 'application/octet-stream', 5929),
(2, 2, 'My first attempt on creating a mobile app using phonegap', '<p>So our company wanted to step on mobile development avenue and we wanted to cook up a quick mobile application as a demo. The problem was we didn&#39;t have anyone in our team who have had experience with building mobile application, added to that we wanted to make sure that the application we build will run on major mobile devices or OS. Ayhan our VP of Software Engineering team in Innovate knew exaclty what we needed - phonegap. It didn&#39;t take much time to write simple apps using phonegap because all we needed to know was HTML,CSS and javascript. After adding jquery mobile to the mix, we were able to improve on the a<span class="st"><em>esthetics</em> appeal of the UI.</span></p>\r\n\r\n<p>Then one day when I was hanging out with my friends, we were talking about how nice it would be if we had an application that would keep taps of petty amounts that we owed each other. &nbsp; I went like :<br />\r\n<img alt="" src="http://newapassa.com/Deewen/Settings/Images/challenge_accepted.png" /></p>\r\n\r\n<p>So I started on a simple app using obviously phonegap. If you are trying out phonegap and your app heavily uses lists(as most of them tend to do), I do have one suggestion. I noticed that its much faster if we don&#39;t initialize(append content to list and refresh it) the lists using jquery mobile at the startup but modify the code so that the list gets initilized/populated when it is needed. For eg: I had lists for borrowings and lendings which I would initialize on device ready event which was obviously slowing down my startup, but later I modified the js code so that I would only append content to the list and refresh it prior to calling changePage. Last but not least, I really want to thank my lil brother Nishant who helped me build this application and for building those awesome logos for the app.</p>\r\n\r\n<p>I have attached the application along with this thread and you can download it from the link provided above. At the moment it can only be run in android. I have yet to find out a way to make it available in IOS without me having to manually add the device identification number while building the app! If you know how to do it then please help me out :)</p>\r\n\r\n<p>&nbsp;</p>\r\n\r\n<p>&nbsp;</p>', '2013-02-20 23:20:19', NULL, NULL, NULL, NULL),
(3, 3, 'If possible always avoid running queries against INFORMATION_SCHEMA specially on ajax requests', '<p><abstract>I was having pretty difficult time to figure out what was causig my ajax request to complete in 6 seconds or more. Well after you have read the title I think you already know where this is going but I really had to spend considerable amount of time to figure it out. So I basically had a rest end point where I would instantiate a model and call some methods on it. </abstract>This model took a table name as&nbsp;constructor&nbsp;parameter and it would in turn execute :</p>\r\n\r\n<div class="code">\r\n<p>&quot;SELECT UPPER(COLUMN_NAME) as column_name FROM INFORMATION_SCHEMA.COLUMNS WHERE LOWER(TABLE_NAME) = :table_name&quot;</p>\r\n</div>\r\n\r\n<p>in order to get the column names of that table. Guess how much time it took to execute - whooping&nbsp;6.29secs.</p>\r\n\r\n<p>It was difficult for me to figure this out because there were other SELECT statements with GROUP BY clause being used which grabbed all my attention while this&nbsp;particular query just escaped my radar. &nbsp;</p>', '2013-02-25 03:53:43', NULL, NULL, NULL, NULL),
(4, 2, 'Phonegap : How to play local music file in IOS', '<p><abstract>OK you might be thinking what&#39;s the big deal!! Just go throught the tutorial <a href="http://docs.phonegap.com/en/2.7.0/cordova_media_media.md.html#Media" target="_blank">here</a> and get things done right? Well but in the example, there is nothing about loading music file from local installation.</abstract> The first step for us is to find out what is the root path in the mobile phone, here is the javascript snippet with complete example:</p>\r\n\r\n<div class="code">\r\n<p>var myApp = {<br />\r\n&nbsp; &nbsp; rootPath: null,<br />\r\n&nbsp; &nbsp; initialize: function() {<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; var self = this;<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; document.addEventListener(&quot;deviceready&quot;,<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; function() {<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.setRootPath();<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.playMusic(&quot;music/xyz.mp3&quot;);<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; , false);<br />\r\n&nbsp; &nbsp; }<br />\r\n&nbsp; &nbsp; , setRootPath: function() {<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; var curURL = document.URL;<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; var root = curURL.replace(/(\\/index.html)$/i, &quot;&quot;) + &quot;/&quot;;<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; if (root.indexOf(&quot;file:&quot;) == 0) {<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>//remove file:/// from the path because IOS cannot read that URL!<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //eg : android and browsers have no issue loading &quot;file:///var/mobile/Applications/594947CB-A600-42D7-8781-8CE944D61061/Library/HydraApps/0/music/xyz.mp3&quot;<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //but ios however cannot play from such path, the valid one for IOS is &quot;/var/mobile/Applications/594947CB-A600-42D7-8781-8CE944D61061/Library/HydraApps/0/music/xyz.mp3&quot;<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //this took quite some time for me to figure out</b><br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; this.rootPath = root.substr(8);<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; }else{<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; this.rootPath = root;<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; }</p>\r\n\r\n<p>&nbsp; &nbsp; }<br />\r\n&nbsp; &nbsp; , playMusic: function(mp3File) {<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; //assuimg all your music file are within asset/www/music folder<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; var media = new Media(this.rootPath + &nbsp;mp3File,<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; function() {<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.log(&quot;playAudio():Audio Success&quot;);<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; function(err) {<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.log(&quot;playAudio():Audio Error: &quot; + err);<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (var e in err) {<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //alert(e+&quot; --- &quot;+err[e]);<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.log(e + &quot; --- &quot; + err[e]);<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; media.play();<br />\r\n&nbsp; &nbsp; }</p>\r\n\r\n<p>}</p>\r\n</div>', '2013-05-23 22:04:54', NULL, NULL, NULL, NULL)
EOD;
	array_push($records, $record);	

		foreach($tables as $table){
			$query = $this->db->query($table['script']);	
			echo '<div>TABLE '.$table['name'].' CREATED.</div>';
		}
		foreach($records as $record){
			$query = $this->db->query($record);	
			echo '<div>INSERT COMPLETED.</div>';
		}
		foreach($constraints as $constraint){
			if(!$this->doesConstraintExist($constraint['name'])){
				$this->db->query($constraint['script']);	
				echo '<div>CONSTRAINT '.$constraint['name'].' ADDED.</div>';
			}
		}
		

		echo '<div>SETUP COMPLETED.</div>';
	}
}

?>